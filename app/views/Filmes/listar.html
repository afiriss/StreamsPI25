#{extends 'main.html' /} 
#{set title:'Catálogo' /}

<div class="container">
    <h1 class="page-title text-center">Catálogo de Filmes</h1>

    #{if filmesRomance.size() > 0}
        <div class="genre-section">
            <h2 class="genre-title">Romance</h2>
            <div class="movie-grid">
                #{list items:filmesRomance, as:'filme'}
                    <div class="movie-card">
                        <img src="/public/images/${filme.imagemUrl}" alt="Capa do filme ${filme.nome}">
                        <div class="info">
                            <h5>${filme.nome}</h5>
                            <p>${filme.genero}</p>
                            <a href="@{Carrinho.adicionar(filme.id)}" class="btn btn-add-cart mt-2">Adicionar</a>
                        </div>
                    </div>
                #{/list}
            </div>
        </div>
    #{/if}

    #{if filmesComedia.size() > 0}
        <div class="genre-section">
            <h2 class="genre-title">Comédia</h2>
            <div class="movie-grid">
                #{list items:filmesComedia, as:'filme'}
                    <div class="movie-card">
                        <img src="/public/images/${filme.imagemUrl}" alt="Capa do filme ${filme.nome}">
                        <div class="info">
                            <h5>${filme.nome}</h5>
                            <p>${filme.genero}</p>
                            <a href="@{Carrinho.adicionar(filme.id)}" class="btn btn-add-cart mt-2">Adicionar</a>
                        </div>
                    </div>
                #{/list}
            </div>
        </div>
    #{/if}

    #{if filmesTerror.size() > 0}
        <div class="genre-section">
            <h2 class="genre-title">Terror</h2>
            <div class="movie-grid">
                #{list items:filmesTerror, as:'filme'}
                    <div class="movie-card">
                        <img src="/public/images/${filme.imagemUrl}" alt="Capa do filme ${filme.nome}">
                        <div class="info">
                            <h5>${filme.nome}</h5>
                            <p>${filme.genero}</p>
                            <a href="@{Carrinho.adicionar(filme.id)}" class="btn btn-add-cart mt-2">Adicionar</a>
                        </div>
                    </div>
                #{/list}
            </div>
        </div>
    #{/if}
    
    #{if filmesRomance.isEmpty() && filmesComedia.isEmpty() && filmesTerror.isEmpty()}
         <p class="text-center mt-5">Nenhum filme encontrado no catálogo.</p>
    #{/if}
</div>

#{set 'moreScripts'}
    <script src="@{'/public/javascripts/jquery-1.6.4.min.js'}"></script>

    <script type="text/javascript">
        $(document).ready(function() {
            // Intercepta o clique em qualquer elemento com a classe .btn-add-cart
            $('.btn-add-cart').click(function(e) {
                // 1. Impede que o link abra a nova página
                e.preventDefault();

                // 2. Pega a URL do atributo href do botão clicado
                var url = $(this).attr('href');
                var botao = $(this); // Salva referência do botão para mudar texto/cor depois

                // 3. Faz a requisição AJAX
                $.ajax({
                    type: 'POST', // ou 'GET', dependendo da sua rota, mas POST é ideal para ações
                    url: url,
                    success: function(resposta) {
                        // 4. Executa isso se der certo
                        // Você pode usar um alert simples ou algo mais elegante
                        alert(resposta); 
                        
                        // Exemplo visual: Muda o texto do botão temporariamente
                        var textoOriginal = botao.text();
                        botao.text("Adicionado!").addClass("btn-success");
                        setTimeout(function(){
                            botao.text(textoOriginal).removeClass("btn-success");
                        }, 2000);
                    },
                    error: function() {
                        alert("Erro ao adicionar o filme. Verifique se você está logado.");
                    }
                });
            });
        });
    </script>
    <script src="@{'/public/javascripts/jquery-1.6.4.min.js'}"></script>
<script type="text/javascript">
    $(document).ready(function() {
        // .unbind garante que não haja múltiplos eventos presos ao mesmo botão
        $('.btn-add-cart').unbind('click').click(function(e) {
            e.preventDefault();
            var botao = $(this);
            
            // Evita duplo clique rápido desabilitando o botão temporariamente
            if (botao.hasClass('disabled')) return;
            botao.addClass('disabled');

            $.ajax({
                url: botao.attr('href'),
                type: 'POST',
                dataType: 'json',
                success: function(data) {
                    alert(data.mensagem);
                    
                    // Atualiza o contador lá em cima no menu
                    var count = data.totalItens > 0 ? data.totalItens : "";
                    $('#contador-carrinho').text(count);
                    
                    botao.removeClass('disabled');
                },
                error: function() {
                    alert("Erro ao adicionar.");
                    botao.removeClass('disabled');
                }
            });
        });
    });
</script>
#{/set}
